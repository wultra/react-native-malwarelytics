// Top-level build file where you can add configuration options common to all sub-projects/modules.

// Load Artifactory credentials from 'ext {}' or from 'local.properties' file. It's expected
// that credentials are set in 'wultraArtifactory_username' or 'wultraArtifactory_password'
// properties.
def loadArtifactoryCredentials(name) {
    def propName = 'wultraArtifactory_' + name
    // At first, try root project's ext dictionary
    if (rootProject.ext.has(propName)) {
        return rootProject.ext.get(propName)
    }
    // Now try to iterate over all possible local.properties files
    def propFiles = [
        project.rootProject.file('local.properties'),
        project.file('local.properties')
    ]
    for (file in propFiles) {
        if (file.canRead()) {
            def props = new Properties()
            props.load(file.newDataInputStream())
            def value = props[propName]
            if (value != null) {
                return value
            }
        }
    }
    logger.error('Failed to resolve required property: ' + propName)
    return null
}

buildscript {
    ext {
        buildToolsVersion = "33.0.0"
        minSdkVersion = 22
        compileSdkVersion = 33
        targetSdkVersion = 33

        // We use NDK 23 which has both M1 support and is the side-by-side NDK version from AGP.
        ndkVersion = "23.1.7779620"
    }
    repositories {
        google()
        mavenCentral()
    }
    dependencies {
        classpath("com.android.tools.build:gradle:7.3.1")
        classpath("com.facebook.react:react-native-gradle-plugin")
    }
}

allprojects {
    repositories {
        maven {
            url 'https://wultra.jfrog.io/artifactory/malwarelytics-android/'
            credentials {
                username loadArtifactoryCredentials('username')
                password loadArtifactoryCredentials('password')
            }
        }
    }
}
